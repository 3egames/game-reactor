import{r as p}from"./index-8db94870.js";import"./_commonjsHelpers-042e6b4d.js";var b={exports:{}},m={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X=p,$=Symbol.for("react.element"),k=Symbol.for("react.fragment"),A=Object.prototype.hasOwnProperty,U=X.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,F={key:!0,ref:!0,__self:!0,__source:!0};function I(o,t,s){var e,n={},r=null,a=null;s!==void 0&&(r=""+s),t.key!==void 0&&(r=""+t.key),t.ref!==void 0&&(a=t.ref);for(e in t)A.call(t,e)&&!F.hasOwnProperty(e)&&(n[e]=t[e]);if(o&&o.defaultProps)for(e in t=o.defaultProps,t)n[e]===void 0&&(n[e]=t[e]);return{$$typeof:$,type:o,key:r,ref:a,props:n,_owner:U.current}}m.Fragment=k;m.jsx=I;m.jsxs=I;b.exports=m;var x=b.exports;const N=x.Fragment,g=x.jsx,M=x.jsxs;class O{constructor(t){this.config=t,this.canvasRef=null,this._canvas2DCtx=null}get Config(){return this.config}setCanvas2DContext(t){this._canvas2DCtx=t}set CanvasRef(t){this.canvasRef=t}get Canvas2DContext(){if(this.canvasRef&&this.canvasRef.current instanceof HTMLCanvasElement&&(this._canvas2DCtx=this.canvasRef.current.getContext("2d")),!this._canvas2DCtx)throw new Error("Canvas context being accessed but is not available.");return this._canvas2DCtx}clear(){this.Canvas2DContext&&(this.Canvas2DContext.clearRect(0,0,this.config.width,this.config.height),this.Canvas2DContext.fillStyle=this.Config.bgColor||"blue",this.Canvas2DContext.fillRect(0,0,this.config.width,this.config.height))}get PagePosition(){var s,e;const t=(e=(s=this.canvasRef)==null?void 0:s.current)==null?void 0:e.getBoundingClientRect();return{left:(t==null?void 0:t.left)||0,top:(t==null?void 0:t.top)||0}}drawElement(t,s){if(this.Canvas2DContext){s=s||{x:t.Config.pos.x,y:t.Config.pos.y};let e=t.ImageSource;e&&this.Canvas2DContext.drawImage(e,s.x,s.y)}}drawText(t,s,e){if(this.Canvas2DContext){this.Canvas2DContext.font="Arial",this.Canvas2DContext.fillStyle="black",this.Canvas2DContext.strokeStyle="",s=s||{x:0,y:0};const n=e.size||"10px",r=e.family||"Arial",a=e.color||"#000";this.Canvas2DContext.font=`${n} ${r}`,this.Canvas2DContext.fillStyle=a,this.Canvas2DContext.fillText(t,s.x,s.y),this.Canvas2DContext.textBaseline="top",e.stroke_width&&(this.Canvas2DContext.strokeStyle=e.stroke_color||"#fff",this.Canvas2DContext.lineWidth=e.stroke_width,this.Canvas2DContext.strokeText(t,s.x,s.y))}}}let C;const T={source:"",spriteCoordinates:{x:0,y:0,width:20,height:20},renderOffset:{x:0,y:0},scale:1};class j{constructor(){this.sources={},this.sprites={},C=this}addSource(t,s){C.sources[t]={path:s,ref:p.createRef()}}getSource(t){var s;return(s=C.sources[t].ref)==null?void 0:s.current}addSprite(t,s,e){if(!this.sources[s])throw new Error(`Sprite source ID '${s}' does not exist`);this.sprites[t]={...T,...e}}getSprite(t){if(!this.sprites[t])throw new Error(`Sprite '${t}' does not exist.`);return this.sprites[t]}render(){const t=[],s=Object.entries(this.sources);for(const[e,n]of s)t.push(g("img",{alt:"Image for "+e,ref:n.ref,src:n.path,hidden:!0},`game-reactor_${n.path}`));return g("div",{id:"BRAND_ID_SPRITES",children:t})}}class G{constructor(){this.elements={},this.elementIndex=[]}add(t){this.elements[t.Config.name]=t,this.elementIndex.push(t)}get(t){if(!this.elements[t])throw new Error(`Element ${t} not found`);return this.elements[t]}update(t,s){for(let e=0;e<this.elementIndex.length;e+=1)this.elementIndex[e].onUpdate&&typeof this.elementIndex[e].onUpdate=="function"&&this.elementIndex[e].onUpdate(t,s)}redraw(t,s){for(let e=0;e<this.elementIndex.length;e+=1)this.elementIndex[e].onDraw&&typeof this.elementIndex[e].onDraw=="function"&&this.elementIndex[e].onDraw(t,s)}}const L={family:"Arial",size:"10px",color:"black",style:"normal",variant:"normal",weight:"normal"};let f;class K{constructor(){f={},this.add("default")}add(t,s={}){if(f[t])throw new Error(`Font '${t}' already set`);f[t]={...L,...s}}get(t){if(!f[t])throw new Error(`Font '${t}' not set`);return f[t]}}class z{constructor(){this.status="ready",this.audio=new Audio,this.audio.onplay=()=>{this.status="playing"},this.audio.onplaying=()=>{this.status="playing"},this.audio.onwaiting=()=>{this.status="ready"},this.audio.onpause=()=>{this.status="paused"},this.audio.onended=()=>{this.status="ready"}}get Status(){return this.status}get Source(){return this.audio.src}set Source(t){this.audio.src=t}async play(){typeof window<"u"&&(await this.audio.play().catch(t=>console.log(t)),this.status="playing")}pause(){typeof window<"u"&&this.audio.pause()}mute(){typeof window<"u"&&(this.audio.muted=!0)}unmute(){typeof window<"u"&&(this.audio.muted=!1)}}class V{constructor(t,s=10){this.logger=t,this.sources={},this.channels=[],this.logger.info(`Initiating ${s} Audio Channels...`);for(let e=0;e<s;e+=1)this.channels[e]=new z,this.channels[e].mute()}getNextAvailableChannel(){const t=this.channels.findIndex(s=>s.Status==="ready");if(t<0)throw new Error("Too much audio playing at once");return t}addSource(t,s){if(this.sources[t])throw new Error(`Sound source '${t}' already exists`);this.sources[t]=s,this.logger.debug(`Added sound '${t}' with source '${s}'`)}async play(t){if(!this.sources[t])throw new Error(`Sound source '${t}' does not exist`);if(typeof window<"u"){const s=this.getNextAvailableChannel();this.logger.debug(`Playing ${t} on channel#${s}`),this.channels[s].Source=this.sources[t],this.channels[s].unmute(),await this.channels[s].play()}}stopAll(){this.logger.info("Pausing audio channels"),typeof window<"u"&&this.channels.map(t=>{t.Status!=="ready"&&(t.pause(),t.mute())})}}var v=(o=>(o[o.warn=0]="warn",o[o.info=1]="info",o[o.debug=2]="debug",o))(v||{});class q{constructor(t,s){this.logLevel=s,this.gameId=t}debug(t){this.logLevel==2&&console.log(`[GID${this.gameId}][DEBUG] ${t}`)}info(t){this.logLevel>=1&&console.log(`[GID${this.gameId}][INFO] ${t}`)}warn(t){this.logLevel>=0&&console.log(`[GID${this.gameId}][WARN] ${t}`)}}let l,h;var u=(o=>(o[o.unknown=0]="unknown",o[o.left=1]="left",o[o.right=2]="right",o[o.middle=3]="middle",o[o.back=4]="back",o[o.forward=5]="forward",o))(u||{});const W={name:"Unnamed Game",viewport:{showCollisions:!1,showPerfStats:!1,fps:30,width:360,height:270}};class B{constructor(t,s){this.instanceID=Math.round(Math.random()*1e3),this.logger=new q(this.instanceID.toString(),t.logLevel=v.info),this.logger.info("Initializing game instance..."),this.state=s,this.config={...W,...t},this.viewport=new O(t.viewport),this.elements=new G,this.fonts=new K,this.sounds=new V(this.logger),this.sprites=new j,l=this}onComponentMounted(){l.logger.info("Game component mounted!"),h!==null&&clearInterval(h),this.onReady(),this.startGameLoop()}onComponentUnmount(){this.logger.info("Game component unmounted!"),h&&clearInterval(h),this.sounds.stopAll(),this.onDisengaged()}get ShowCollisions(){return this.config.viewport.showCollisions}get Name(){return this.config.name}get State(){return l.state}startGameLoop(){let t=1,s=1e3/l.config.viewport.fps*t,e=0,n=new Date().getTime(),r=n,a=0;h&&clearInterval(h),h=setInterval(()=>{r=new Date().getTime(),a=r-n,e+=a,e>s&&(l.onUpdate(a),l.onDraw(a,{frameNumber:t}),t+=1,s=1e3/l.config.viewport.fps*t),e>1e3&&(e-=1e3,t=1,s=1e3/l.config.viewport.fps*t),n=r},10)}onMouseClick(t){}onMouseDown(t){}onMouseUp(t){}}const w=({id:o,game:t,className:s})=>{const e=p.useRef(null);p.useEffect(()=>(t.onComponentMounted(),n(t),()=>{t.onComponentUnmount&&t.onComponentUnmount()}),[]);function n(i){i.viewport.CanvasRef=e}function r(i){let c=u.unknown;return i.button===0||i.buttons===1?c=u.left:i.button===2||i.buttons===2?c=u.right:i.button===1||i.buttons===4?c=u.middle:i.button===3||i.buttons===8?c=u.back:(i.button===4||i.buttons===16)&&(c=u.forward),{button:c,withCtrlKey:i.ctrlKey,withAltKey:i.altKey,withMetaKey:i.metaKey,withShiftKey:i.shiftKey,x:Math.ceil(i.clientX-t.viewport.PagePosition.left),y:Math.ceil(i.clientY-t.viewport.PagePosition.top)}}function a(i){i.preventDefault(),t.onMouseClick&&t.onMouseClick(r(i))}function S(i){return i.preventDefault()}function _(i){return i.preventDefault()}function R(){t.state.isPlaying=!1}function Y(i){i.preventDefault(),t.onMouseDown&&t.onMouseDown(r(i))}function E(i){i.preventDefault(),t.onMouseUp&&t.onMouseUp(r(i))}return M(N,{children:[g("canvas",{className:s,id:o,ref:e,height:t.config.viewport.height,width:t.config.viewport.width,onBlur:R,onClick:a,onContextMenu:S,onDoubleClick:_,onMouseDown:Y,onMouseUp:E,children:"Canvas not supported by browser"}),t.sprites.render()]})};try{w.displayName="GameComponent",w.__docgenInfo={description:"",displayName:"GameComponent",props:{id:{defaultValue:null,description:"",name:"id",required:!0,type:{name:"string"}},game:{defaultValue:null,description:"",name:"game",required:!0,type:{name:"Game"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}}}catch{}class H{constructor(){this.boxes=[],this.isActive=!1}get Active(){return this.isActive}set Active(t){this.isActive=t}get Boxes(){return this.boxes}addBox(t){this.boxes.push(t)}collidesWithElement(t){var s;if(this.isActive&&((s=t.Config.collisions)!=null&&s.Active)){let e,n;for(let r=0;r<this.Boxes.length;r++)for(let a=0;a<t.Config.collisions.Boxes.length;a++){if(e=this.Boxes[r],n=t.Config.collisions.Boxes[a],e.XPos>=n.XPos&&e.XPos<=n.X2Pos&&e.YPos>=n.YPos&&e.YPos<=n.Y2Pos)return!0;if(e.X2Pos>=n.XPos&&e.X2Pos<=n.X2Pos&&e.YPos>=n.YPos&&e.YPos<=n.Y2Pos)return!0;if(e.XPos>=n.XPos&&e.XPos<=n.X2Pos&&e.Y2Pos>=n.YPos&&e.Y2Pos<=n.Y2Pos)return!0;if(e.X2Pos>=n.XPos&&e.X2Pos<=n.X2Pos&&e.Y2Pos>=n.YPos&&e.Y2Pos<=n.Y2Pos||n.XPos>=e.XPos&&n.XPos<=e.X2Pos&&n.YPos>=e.YPos&&n.YPos<=e.Y2Pos)return!0;if(n.X2Pos>=e.XPos&&n.X2Pos<=e.X2Pos&&n.YPos>=e.YPos&&n.YPos<=e.Y2Pos)return!0;if(n.XPos>=e.XPos&&n.XPos<=e.X2Pos&&n.Y2Pos>=e.YPos&&n.Y2Pos<=e.Y2Pos)return!0;if(n.X2Pos>=e.XPos&&n.X2Pos<=e.X2Pos&&n.Y2Pos>=e.YPos&&n.Y2Pos<=e.Y2Pos)return!0}}return!1}}const J={name:"Unnamed Element",sprite:"",state:{enabled:!1},pos:{x:0,y:0},size:{width:10,height:10,scale:1}};class Q{constructor(t,s){this.game=t,this.config={...J,...s},this.config.collisions=new H}get ImageSource(){return this.game.sprites.getSource(this.config.sprite)}get Config(){return this.config}}class Z extends Q{constructor(t){super(t,{name:"my-avatar",sprite:"avatar",state:{},pos:{x:20,y:20}}),this.xDirRight=!0,this.yDirDown=!0}onUpdate(t,s){this.yDirDown?(this.Config.pos.y+=5,this.Config.pos.y+50>t.viewport.Config.height&&(this.yDirDown=!1)):(this.Config.pos.y-=5,this.Config.pos.y<0&&(this.yDirDown=!0)),this.xDirRight?(this.Config.pos.x+=5,this.Config.pos.x+50>t.viewport.Config.width&&(this.xDirRight=!1)):(this.Config.pos.x-=5,this.Config.pos.x<0&&(this.xDirRight=!0))}onDraw(t,s){t.viewport.clear(),t.viewport.drawElement(this)}playSound(){}}class tt extends B{constructor(){super({name:"hellogame",logLevel:v.debug,viewport:{showPerfStats:!0,fps:30,width:360,height:270,bgColor:"red"}},{someFlag:!0,clickCount:0}),this.sounds.addSource("blast","https://soundbible.com/mp3/Laser_Cannon-Mike_Koenig-797224747.mp3"),this.sprites.addSource("avatar","https://pixeljoint.com/files/icons/ladyhazy.gif")}onReady(){this.elements.add(new Z(this)),this.startGameLoop()}onDisengaged(){}onDraw(t,s){if(this.elements.redraw(this,t),this.config.viewport.showPerfStats){const e=this.fonts.get("default");this.viewport.drawText("Game Reactor by: Adonis Lee Villamor",{x:10,y:240},e),this.viewport.drawText(`Frame: ${s.frameNumber}/${this.config.viewport.fps}`,{x:260,y:240},e)}}onUpdate(t){this.elements.update(this,t)}onMouseDown(t){this.sounds.play("blast")}}const et=new tt,ot={component:w,title:"GameReactor component",argTypes:{},parameters:{docs:{description:{component:"STORYBOOK"}}}},d=o=>g(w,{className:"border-solid","data-testId":"InputField-id",...o});d.args={id:"primarytest",game:et};var y,P,D;d.parameters={...d.parameters,docs:{...(y=d.parameters)==null?void 0:y.docs,source:{originalSource:`args => <GameComponent className='border-solid' data-testId="InputField-id" {...args} />`,...(D=(P=d.parameters)==null?void 0:P.docs)==null?void 0:D.source}}};const it=["Primary"];export{d as Primary,it as __namedExportsOrder,ot as default};
//# sourceMappingURL=GameComponent.stories-fffa54c6.js.map
